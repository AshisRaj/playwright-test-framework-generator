import { expect, test } from '@fixtures';
import { APIResponse } from '@playwright/test';

test('Create profile', { tag: ['@smoke', '@regression'] }, async ({ apiService, apiData }) => {
  let response: APIResponse;

  await test.step('Send create profile request', async () => {
    response = await apiService.post('/profiles', apiData.profiles.newProfile);
  });

  await test.step('Verify profile creation response', async () => {
    expect(response.status()).toBe(201);
  });
});

test(
  'Get profile by userId',
  { tag: ['@smoke', '@regression'] },
  async ({ apiService, apiData }) => {
    let response: APIResponse;

    await test.step('Fetch profile by userId', async () => {
      response = await apiService.get(`/profiles/${apiData.profiles.userId}`);
    });

    await test.step('Verify profile details', async () => {
      expect(response.status()).toBe(200);

      const profile = await response.json();
      expect(profile.designation).toBe('Principal SDET');
    });
  },
);
